<link href="/css/textEditor.css" rel="stylesheet" />
<div class="container">
  <article>
    <div id="post-id" hidden><%=post.id %></div>
    <header>
      <h2>Game: <%= post.game_name %></h2>
      <h2>Author: <%= post.username %></h2>
      <h1><%= post.title %></h1>
      <h6>
        <time
          datetime="<%= post.created %>"
          title="<%= moment(post.created).format('dddd, MMMM Do YYYY') %>"
          ><%= moment(post.created).format("MMMM Do") %></time
        >
      </h6>
      <h3><%= post.subtitle %></h3>
    </header>
    <!-- article body -->
    <div id="post-text">
      <%- post.text %>
    </div>
    <div id="button-panel">
      <% if (typeof user === 'undefined' || user.id !==post.user_id ) {%>
      <button id="share">Share</button>
      <%} else { %>
      <button id="edit" onclick="editPost(event)">Edit</button>
      <% } %>
    </div>
    <div id="editor"></div>
    <div id="commento"></div>
  </article>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <!-- May need to return this for performance -->
  <!-- <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" /> -->
  <script src="https://cdn.commento.io/js/commento.js"></script>
  <script src="/javascript/textEditor.js"></script>
  <script>
    function editPost(e) {
      const buttonPanel = document.getElementById("button-panel");

      const editButton = document.getElementById("edit");
      const form = document.createElement("form");
      const submitButton = document.createElement("input");
      submitButton.setAttribute("type", "submit");
      submitButton.setAttribute("value", "submit");

      form.appendChild(submitButton);
      buttonPanel.appendChild(form);

      const postText = document.getElementById("post-text");
      // Assing to be used later in the quill editor
      const editText = postText.innerHTML;
      console.log(editText);
      postText.innerHTML = "";

      const editorDiv = document.createElement("div");
      editorDiv.id = "editor";
      postText.appendChild(editorDiv);

      var quill = new Quill("#editor", {
        theme: "snow"
      });

      quill.clipboard.dangerouslyPasteHTML(editText);

      editButton.outerHTML = "";
      submitButton.addEventListener("click", function(e) {
        editFormSubmit(e, form, quill, "/posts/updatePost");
      });
    }
  </script>
</div>
